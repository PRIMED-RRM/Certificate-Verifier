<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRIMED Certificate Verifier</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/html5-qrcode@2.3.10/html5-qrcode.min.js"></script>

<style>
:root{
  --bg:#e3f2fd;
  --card:#fff;
  --primary:#0d6efd;
}
body{
  font-family:Roboto,sans-serif;
  background:var(--bg);
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
}
.container{
  width:95%;
  max-width:500px;
  background:var(--card);
  padding:20px;
  margin-top:20px;
  border-radius:18px;
  box-shadow:0 12px 35px rgba(0,0,0,.15);
  text-align:center;
}
.logo-wrap{
  display:flex;
  justify-content:center;
  gap:15px;
  margin-bottom:10px;
}
.logo-wrap img{height:60px}
.org-title{font-size:12px;letter-spacing:1px;color:#555}
.main-title{font-size:20px;font-weight:700;color:var(--primary);margin:10px 0}
select,input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-bottom:10px;
}
.btn{
  padding:10px 18px;
  border-radius:10px;
  border:none;
  margin:5px;
  cursor:pointer;
}
.btn-primary{
  background:linear-gradient(90deg,#0d6efd,#084298);
  color:#fff;
}
.btn-secondary{background:#f1f1f1}

#qr-reader{
  width:100%;
  max-width:320px;
  margin:15px auto 5px;
  display:none;
}
#scanner-controls{
  display:none;
  margin-bottom:10px;
}
#result{
  background:#f8f9fa;
  border-radius:12px;
  padding:12px;
  text-align:left;
  margin-top:10px;
}
.valid{color:green;font-weight:600}
.invalid{color:red;font-weight:600}

footer{
  margin:15px 0;
  font-size:12px;
  color:#555;
  text-align:center;
}
</style>
</head>

<body>

<div class="container">

  <div class="logo-wrap">
    <img src="https://raw.githubusercontent.com/PRIMED-RRM/primedrrmverifier/refs/heads/main/PRIMED%20Logo%201.png">
    <img src="https://raw.githubusercontent.com/PRIMED-RRM/primedrrmverifier/refs/heads/main/BackgroundEraser_20251102_093006990.png">
  </div>

  <div class="org-title">PRIMED RISK REDUCTION MANAGEMENT TRAINING SERVICES</div>
  <div class="main-title">CERTIFICATE VERIFIER</div>

  <input id="certInput" placeholder="Enter Certificate Number">

  <div>
    <button class="btn btn-primary" onclick="verifyCert()">Verify</button>
    <button class="btn btn-secondary" id="openScannerBtn">Open QR Scanner</button>
  </div>

  <div id="qr-reader"></div>

  <div id="scanner-controls">
    <button class="btn btn-secondary" id="flashBtn">Toggle Flashlight</button>
  </div>

  <div id="result"></div>

</div>

<footer>
© 2025 PRIMED RRMTS | All rights reserved
</footer>

<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbyEKx6AzEjRdPjeYUMjhOZNXtv0ybC7vgukImCW5qK76YZV8dT2CStaOUc5XvX_0flhEw/exec";

let qrScanner=null;
let videoTrack=null;
let torch=false;

function verifyCert(val){
  const cert=val||document.getElementById("certInput").value.trim();
  const res=document.getElementById("result");
  if(!cert){res.innerHTML="<span class='invalid'>Enter certificate number</span>";return;}

  res.innerHTML="Checking...";
  fetch(`${API_URL}?cert=${encodeURIComponent(cert)}`)
  .then(r=>r.json())
  .then(d=>{
    if(d.found){
      res.innerHTML=`<span class="valid">VALID CERTIFICATE ✅</span><br><br>
      <b>Name:</b> ${d.name}<br>
      <b>Certificate #:</b> ${d.certificate}<br>
      <b>Training:</b> ${d.training}<br>
      <b>Date:</b> ${new Date(d.date).toLocaleDateString()}<br>
      <b>Venue:</b> ${d.venue}`;
      document.getElementById("beep").play();
    }else{
      res.innerHTML="<span class='invalid'>Certificate not found ❌</span>";
    }
  });
}

function startScanner(){
  const reader=document.getElementById("qr-reader");
  const controls=document.getElementById("scanner-controls");

  reader.style.display="block";
  controls.style.display="block";

  qrScanner=new Html5Qrcode("qr-reader");
  qrScanner.start(
    {facingMode:"environment"},
    {fps:10,qrbox:250},
    txt=>{
      stopScanner();
      document.getElementById("certInput").value=txt;
      verifyCert(txt);
    }
  ).then(()=>{
    const video=document.querySelector("#qr-reader video");
    if(video && video.srcObject){
      videoTrack=video.srcObject.getVideoTracks()[0];
    }
  }).catch(e=>{
    alert("Camera access failed. Allow camera permission.");
    stopScanner();
  });
}

function stopScanner(){
  const reader=document.getElementById("qr-reader");
  const controls=document.getElementById("scanner-controls");

  if(qrScanner){
    qrScanner.stop().then(()=>qrScanner.clear());
    qrScanner=null;
  }
  reader.style.display="none";
  controls.style.display="none";
  torch=false;
}

document.getElementById("openScannerBtn").onclick=()=>{
  qrScanner?stopScanner():startScanner();
};

document.getElementById("flashBtn").onclick=()=>{
  if(!videoTrack) return;
  const cap=videoTrack.getCapabilities();
  if(!cap.torch){alert("Flashlight not supported");return;}
  torch=!torch;
  videoTrack.applyConstraints({advanced:[{torch:torch}]});
};
</script>

</body>
</html>
