<!DOCTYPE html>
<html>
<head>
  <title>PRIMED Certificate Verification</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Open Graph -->
  <meta property="og:title" content="PRIMED Certificate Verifier">
  <meta property="og:description" content="Verify your training certificates online quickly and securely.">
  <meta property="og:image" content="https://primed-rrm.github.io/Certificate-Verifier/PRIMED%20Logo%201.png">
  <meta property="og:url" content="https://primed-rrm.github.io/Certificate-Verifier/">
  <meta property="og:type" content="website">
  <meta property="fb:app_id" content="1384616316725467">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="PRIMED Certificate Verifier">
  <meta name="twitter:description" content="Verify your training certificates online quickly and securely.">
  <meta name="twitter:image" content="https://primed-rrm.github.io/Certificate-Verifier/PRIMED%20Logo%201.png">

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f5f7fa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background: #fff;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      width: 95%;
      max-width: 480px;
      text-align: center;
      position: relative;
    }
    .logo { width: 90px; margin-bottom: 15px; }
    h2 { color: #007bff; margin-bottom: 15px; }
    input {
      width: 80%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      padding: 8px 18px;
      border-radius: 6px;
      border: none;
      background: #007bff;
      color: white;
      cursor: pointer;
      font-size: 14px;
      margin-bottom: 10px;
    }
    button:hover { background: #0056b3; }
    #result {
      margin-top: 12px;
      text-align: left;
      max-height: 250px;
      overflow-y: auto;
      font-size: 14px;
      background: #f0f3f7;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    #qr-reader { width: 90%; max-width: 300px; margin: 10px auto; }
  </style>

  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>

<body>
  <div class="container">
    <img src="https://primed-rrm.github.io/Certificate-Verifier/PRIMED%20Logo%201.png" alt="Logo" class="logo">
    <h2>PRIMED Certificate Verification</h2>

    <input type="text" id="searchInput" placeholder="Enter Name / Cert # / Date">
    <button onclick="verify()">Verify</button>

    <div id="qr-reader"></div>
    <div id="result"></div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyEKx6AzEjRdPjeYUMjhOZNXtv0ybC7vgukImCW5qK76YZV8dT2CStaOUc5XvX_0flhEw/exec";

    function verify(input) {
      const searchValue = input || document.getElementById("searchInput").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.textContent = "Searching...";

      if(!searchValue) {
        resultDiv.innerHTML = "<b style='color:red'>Please enter a Name, Cert #, or Date</b>";
        return;
      }

      fetch(API_URL)
        .then(res => res.json())
        .then(data => {
          if(!data || !data.records) {
            resultDiv.innerHTML = "<b style='color:red'>No data found</b>";
            return;
          }

          // filter matches by Name, Cert Number, or Training Date
          const matches = data.records.filter(rec => {
            const nameMatch = rec.name.toLowerCase().includes(searchValue.toLowerCase());
            const certMatch = rec.certificate.toLowerCase().includes(searchValue.toLowerCase());
            const dateMatch = rec.date.toLowerCase().includes(searchValue.toLowerCase());
            return nameMatch || certMatch || dateMatch;
          });

          if(matches.length === 0) {
            resultDiv.innerHTML = "<b style='color:red'>No matching certificates found ‚ùå</b>";
            return;
          }

          // display all matches
          let html = "";
          matches.forEach(rec => {
            html += `<b>Name:</b> ${rec.name}<br>`;
            html += `<b>Certificate Number:</b> ${rec.certificate}<br>`;
            html += `<b>Training Date:</b> ${new Date(rec.date).toLocaleDateString()}<br>`;
            html += `<b>Training Venue:</b> ${rec.venue}<br>`;
            html += `<b>Types of Training:</b> ${rec.training}<br>`;
            html += `<hr>`;
          });

          resultDiv.innerHTML = html;
        })
        .catch(() => { 
          resultDiv.innerHTML = "<b style='color:red'>Error connecting to server</b>"; 
        });
    }

    // QR code scanner
    function onScanSuccess(decodedText) {
      html5QrcodeScanner.clear().then(() => {
        document.getElementById("searchInput").value = decodedText;
        verify(decodedText);
      }).catch(err => console.error("QR clear failed", err));
    }

    const html5QrcodeScanner = new Html5QrcodeScanner(
      "qr-reader", { fps: 10, qrbox: 250, rememberLastUsedCamera: true });
    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>
