<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRIMED ADMIN PANEL</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
body{
  font-family: Roboto,sans-serif;
  background: linear-gradient(180deg,#eef3f9,#f9fbfd);
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  margin:0;
  padding:20px;
}
.container{
  background:#fff;
  padding:26px;
  border-radius:14px;
  width:95%;
  max-width:700px;
  box-shadow:0 8px 28px rgba(0,0,0,.15);
  text-align:center;
}
h2{
  color:#0d6efd;
  margin-bottom:10px;
  text-transform:uppercase;
}
input, select{
  width:90%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  padding:8px 12px;
  border:none;
  border-radius:8px;
  font-weight:500;
  margin:2px;
  cursor:pointer;
}
.primary{background:#0d6efd;color:#fff;}
.success{background:#198754;color:#fff;}
.warning{background:#ffc107;color:#000;}
.danger{background:#dc3545;color:#fff;}
#result{
  margin-top:12px;
  text-align:left;
  font-size:14px;
  background:#f3f6fb;
  padding:12px;
  border-radius:10px;
  max-height:150px;
  overflow:auto;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
table, th, td{
  border:1px solid #ccc;
}
th, td{
  padding:6px;
  text-align:left;
  font-size:14px;
  vertical-align:middle;
}
img.qr{
  width:70px;
  height:70px;
  margin-top:4px;
  border:1px solid #ccc;
  border-radius:8px;
}
</style>
</head>
<body>
<div class="container">
<h2>PRIMED TRAINEE ADMIN PANEL</h2>

<input type="text" id="name" placeholder="Trainee Name">
<input type="text" id="certificate" placeholder="Certificate Number">
<select id="training">
  <option value="">Select Training</option>
  <option value="STOP THE BLEED">Stop The Bleed</option>
  <option value="Standard First Aid">Standard First Aid (SFAT)</option>
  <option value="Basic First Aid">Basic First Aid (BFAT)</option>
  <option value="Basic Life Support">Basic Life Support (BLS)</option>
  <option value="CPR">CPR</option>
  <option value="Basic Fire Safety Seminar">Basic Fire Safety Seminar</option>
  <option value="Introduction to DRRM">Introduction to DRRM</option>
  <option value="Earthquake Preparedness Seminar">Earthquake Preparedness Seminar</option>
</select>
<input type="date" id="date">
<input type="text" id="venue" placeholder="Training Venue">

<div>
  <button class="primary" onclick="addTrainee()">Add Trainee</button>
  <button class="warning" onclick="updateTrainee()">Update Trainee</button>
</div>

<div id="result"></div>

<h3>All Trainees</h3>
<table id="traineeTable">
  <thead>
    <tr>
      <th>Name</th>
      <th>Certificate Number</th>
      <th>Type of Training</th>
      <th>Training Date</th>
      <th>Training Venue</th>
      <th>QR Code</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwjH17flRqgdL5UfTx6EXCBDbdselynyt3aUmLfYVJl1aobBKtQbmdFoP7a6HlVMtKOtA/exec"; // your existing Web App URL

// Generate QR image URL for certificate
function generateQRCode(cert){
  return `https://chart.googleapis.com/chart?chs=150x150&cht=qr&chl=${encodeURIComponent(cert)}`;
}

// Fetch all trainees
async function fetchAll(){
  const res = await fetch(API_URL);
  return await res.json();
}

let trainees = [];

function renderTable(){
  const tbody = document.querySelector("#traineeTable tbody");
  tbody.innerHTML="";
  trainees.forEach((t,i)=>{
    tbody.innerHTML+=`
      <tr>
        <td>${t.certificate}</td>
        <td>${t.name}</td>
        <td>${t.training}</td>
        <td>${t.date}</td>
        <td>${t.venue}</td>
        <td>
          <img src="${generateQRCode(t.certificate)}" class="qr" alt="QR">
          <br>
          <a href="${generateQRCode(t.certificate)}" download="${t.certificate}.png">
            <button class="success">Download QR</button>
          </a>
        </td>
        <td>
          <button class="success" onclick="editTrainee(${i})">Edit</button>
          <button class="danger" onclick="deleteTrainee(${i})">Delete</button>
        </td>
      </tr>`;
  });
}

// Load data initially
async function loadData(){ 
  trainees = await fetchAll(); 
  renderTable(); 
}
loadData();

// Form helpers
function getForm(){ 
  return {
    name: document.getElementById("name").value.trim(),
    certificate: document.getElementById("certificate").value.trim(),
    training: document.getElementById("training").value,
    date: document.getElementById("date").value,
    venue: document.getElementById("venue").value.trim()
  };
}

function clearForm(){
  document.getElementById("name").value="";
  document.getElementById("certificate").value="";
  document.getElementById("training").value="";
  document.getElementById("date").value="";
  document.getElementById("venue").value="";
}

// Add trainee
async function addTrainee(){
  const t = getForm();
  if(!t.name||!t.certificate||!t.training){ document.getElementById("result").innerText="Fill required fields ❌"; return;}
  const r = await fetch(API_URL,{method:"POST",body:JSON.stringify({...t,action:"add"})});
  await r.json(); 
  document.getElementById("result").innerText="Trainee Added ✅"; 
  clearForm(); loadData();
}

// Edit trainee
let editIndex = null;
function editTrainee(i){
  const t = trainees[i];
  document.getElementById("name").value = t.name;
  document.getElementById("certificate").value = t.certificate;
  document.getElementById("training").value = t.training;
  document.getElementById("date").value = t.date;
  document.getElementById("venue").value = t.venue;
  editIndex = i;
  document.getElementById("result").innerText=`Editing ${t.certificate}. Press Update to save changes.`;
}

// Update trainee
async function updateTrainee(){
  if(editIndex===null){ document.getElementById("result").innerText="Select a trainee ❌"; return;}
  const t = getForm();
  const oldCert = trainees[editIndex].certificate;
  const r = await fetch(API_URL,{method:"POST",body:JSON.stringify({...t,action:"update",oldCertificate:oldCert})});
  await r.json(); 
  document.getElementById("result").innerText="Trainee Updated ✅"; 
  clearForm(); editIndex=null; loadData();
}

// Delete trainee
async function deleteTrainee(i){
  const cert = trainees[i].certificate;
  if(confirm("Delete "+cert+"?")){
    await fetch(API_URL,{method:"POST",body:JSON.stringify({certificate:cert,action:"delete"})});
    document.getElementById("result").innerText="Trainee Deleted ✅"; 
    loadData();
  }
}
</script>
</body>
</html>
